#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Footer Optimization V4
1. Logo & Text Side-by-Side (Flexbox)
2. Typography Hierarchy: Center Marine (20px Bold) / Certificate Service (14px)
3. Container Max-Width 900px & Centered
4. Tighter Spacing
"""

import os
import re

TARGET_DIR = r"d:\ypm\my web\test\cmcsclass.com"
LOGO_REL_PATH = "wp-content/uploads/2025/07/FullColor_1280x1024_300dpi-1-300x240-removebg-preview.webp"

# Unified Dark Blue Color
THEME_COLOR = "#0c4a6e"

# Icons
ICON_PHONE = f'''<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="{THEME_COLOR}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block; vertical-align:middle; margin-right:10px; min-width:18px;"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>'''

ICON_EMAIL = f'''<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="{THEME_COLOR}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block; vertical-align:middle; margin-right:10px; min-width:18px;"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>'''

ICON_LOCATION = f'''<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="{THEME_COLOR}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block; vertical-align:middle; margin-right:10px; min-width:18px;"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>'''

def get_logo_path_for_file(filepath):
    rel_path = os.path.relpath(filepath, TARGET_DIR)
    depth = rel_path.count(os.sep)
    prefix = "../" * depth
    return prefix + LOGO_REL_PATH

def generate_footer_html(logo_src):
    return f'''<div class="elementor-element elementor-element-2dfd29ab e-con-full e-flex e-con e-parent" data-element_type="container" data-id="2dfd29ab" data-settings='{{"background_background":"gradient"}}' style="padding: 50px 0;">
    
    <!-- Main Center Container (Max Width 900px, Centered) -->
    <div style="max-width: 900px; margin: 0 auto; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; padding: 0 20px;">
        
        <!-- LEFT: Logo + Text (Horizontal Flex) -->
        <div style="flex: 1; min-width: 320px; display: flex; align-items: center; justify-content: flex-start; margin-bottom: 20px;">
            <!-- Logo Image -->
            <a href="index.html" tabindex="-1" style="display: block; margin-right: 15px; flex-shrink: 0;">
                <img alt="Center Marine Certificate Service" src="{logo_src}" style="width: 90px; height: auto; display: block; object-fit: contain;">
            </a>
            
            <!-- Text Block -->
            <div style="display: flex; flex-direction: column; align-items: flex-start;">
                <h3 style="font-size: 20px; font-weight: 700; color: {THEME_COLOR}; margin: 0 0 2px 0; line-height: 1.2; font-family: inherit;">Center Marine</h3>
                <p style="font-size: 14px; font-weight: 400; color: {THEME_COLOR}; margin: 0; opacity: 0.9;">Certificate Service</p>
            </div>
        </div>

        <!-- RIGHT: Contact Info (Centered vertically in the block) -->
        <div style="flex: 1; min-width: 300px; display: flex; flex-direction: column; justify-content: center; align-items: flex-start; color: {THEME_COLOR}; font-size: 16px; font-weight: 500;">
            
            <div style="margin-bottom: 12px; display: flex; align-items: center;">
                {ICON_PHONE}
                <a href="tel:0085261717889" style="color: {THEME_COLOR}; text-decoration: none;">00852-61717889</a>
            </div>

            <div style="margin-bottom: 12px; display: flex; align-items: flex-start;">
                <span style="margin-top: 4px;">{ICON_EMAIL}</span>
                <div style="display:flex; flex-direction:column;">
                    <a href="mailto:technical@cmcsclass.org" style="color: {THEME_COLOR}; text-decoration: none; margin-bottom: 4px;">technical@cmcsclass.org</a>
                    <a href="mailto:fleet@cmcsclass.org" style="color: {THEME_COLOR}; text-decoration: none;">fleet@cmcsclass.org</a>
                </div>
            </div>

            <div style="display: flex; align-items: center;">
                {ICON_LOCATION}
                <span style="color: {THEME_COLOR};">São Tomé and Príncipe</span>
            </div>

        </div>

    </div>

</div>

<!-- Copyright Section -->
<div class="elementor-element elementor-element-3cc2c7f1 e-flex e-con-boxed e-con e-parent" data-element_type="container" data-id="3cc2c7f1" data-settings='{{"background_background":"gradient"}}' style="border-top: 1px solid rgba(12, 74, 110, 0.1); margin-top: 0;">
    <div class="e-con-inner">
        <div class="elementor-element elementor-element-70813cef elementor-widget elementor-widget-heading" data-element_type="widget" data-id="70813cef" data-widget_type="heading.default">
            <p class="elementor-heading-title elementor-size-default" style="font-size: 13px; color: {THEME_COLOR}; opacity: 0.7; text-align: center; padding: 25px 0;">© All rights reserved Center Marine Certificate Service​</p>
        </div>
    </div>
</div>
'''

def fix_footer(filepath):
    try:
        with open(filepath, 'r', encoding='utf-8') as f:
            content = f.read()
    except:
        return False
    
    original = content
    logo_src = get_logo_path_for_file(filepath)
    new_footer = generate_footer_html(logo_src)
    
    start_marker = r'<div class="elementor-element elementor-element-2dfd29ab'
    end_marker = r'</footer>'
    
    pattern = f'({start_marker}.*?){end_marker}'
    
    replacement = new_footer + '\n</footer>'
    
    # Using re.DOTALL to match across lines
    content = re.sub(pattern, replacement, content, flags=re.DOTALL)
    
    if content != original:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        return True
    return False

def main():
    print("=" * 60)
    print("FOOTER OPTIMIZATION V4 - Horizontal Logo & Compact Layout")
    print("=" * 60)
    
    fixed = 0
    for root, dirs, files in os.walk(TARGET_DIR):
        dirs[:] = [d for d in dirs if d not in ['.git', 'node_modules', 'wp-json']]
        for file in files:
            if file.endswith('.html'):
                if fix_footer(os.path.join(root, file)):
                    fixed += 1
                    print(f"  Optimized: {file}")
    
    print(f"\nUpdated {fixed} files")

if __name__ == "__main__":
    main()
