#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Force Restore Footer V8 - Text Wrap Fix
1. Fix "Center Marine" wrapping issue (nowrap + adjust font size).
2. Ensure "Certificate Service" aligns nicely.
3. Keep the "Titan" layout but refine typography for better flow.
"""

import os
import re

TARGET_DIR = r"d:\ypm\my web\test\cmcsclass.com"
# Titan Assets
LOGO_REL_PATH = "wp-content/uploads/2025/07/FullColor_1280x1024_300dpi-1-scaled.webp"
THEME_COLOR = "#0c4a6e"

ICON_PHONE = f'''<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="{THEME_COLOR}" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block; vertical-align:middle; margin-right:16px; min-width:28px;"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>'''

ICON_EMAIL = f'''<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="{THEME_COLOR}" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block; vertical-align:middle; margin-right:16px; min-width:28px;"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>'''

ICON_LOCATION = f'''<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="{THEME_COLOR}" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block; vertical-align:middle; margin-right:16px; min-width:28px;"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>'''

def get_logo_path_for_file(filepath):
    rel_path = os.path.relpath(filepath, TARGET_DIR)
    depth = rel_path.count(os.sep)
    prefix = "../" * depth
    return prefix + LOGO_REL_PATH

def generate_full_footer_html(logo_src):
    return f'''<footer class="elementor elementor-11533 elementor-location-footer">
<div class="elementor-element elementor-element-2dfd29ab e-con-full e-flex e-con e-parent" data-element_type="container" data-id="2dfd29ab" data-settings='{{"background_background":"gradient"}}' style="padding: 100px 0;">
    
    <!-- Full Width 96% -->
    <div style="max-width: 96%; margin: 0 auto; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; padding: 0 40px;">
        
        <!-- LEFT: TITAN LOGO AREA (Flex-Wrap Disabled for inner items) -->
        <div style="flex: 1; min-width: 500px; display: flex; align-items: center; justify-content: flex-start; margin-bottom: 40px;">
            <a href="index.html" tabindex="-1" style="display: block; margin-right: 30px; flex-shrink: 0;">
                <img alt="Center Marine Certificate Service" src="{logo_src}" style="width: 170px; height: auto; display: block; object-fit: contain;">
            </a>
            
            <div style="display: flex; flex-direction: column; align-items: flex-start; justify-content: center;">
                <!-- Adjusted Font (32px) + No Wrap -->
                <h3 style="white-space: nowrap; font-size: 32px; font-weight: 900; color: {THEME_COLOR}; margin: 0 0 2px 0; line-height: 1.1; font-family: inherit; letter-spacing: -0.5px;">Center Marine</h3>
                <p style="white-space: nowrap; font-size: 18px; font-weight: 600; color: {THEME_COLOR}; margin: 0; opacity: 0.9; letter-spacing: 1.5px; text-transform: uppercase;">Certificate Service</p>
            </div>
        </div>

        <!-- RIGHT: TITAN CONTACT INFO -->
        <div style="flex: 1; min-width: 350px; display: flex; flex-direction: column; align-items: flex-end; justify-content: center; color: {THEME_COLOR}; font-size: 20px; font-weight: 600;">
            
            <div style="display: flex; flex-direction: column; align-items: flex-start;">
                <div style="margin-bottom: 22px; display: flex; align-items: center;">
                    {ICON_PHONE}
                    <a href="tel:0085261717889" style="color: {THEME_COLOR}; text-decoration: none;">00852-61717889</a>
                </div>

                <div style="margin-bottom: 22px; display: flex; align-items: flex-start;">
                    <span style="margin-top: 5px;">{ICON_EMAIL}</span>
                    <div style="display:flex; flex-direction:column;">
                        <a href="mailto:technical@cmcsclass.org" style="color: {THEME_COLOR}; text-decoration: none; margin-bottom: 8px;">technical@cmcsclass.org</a>
                        <a href="mailto:fleet@cmcsclass.org" style="color: {THEME_COLOR}; text-decoration: none;">fleet@cmcsclass.org</a>
                    </div>
                </div>

                <div style="display: flex; align-items: center;">
                    {ICON_LOCATION}
                    <span style="color: {THEME_COLOR};">São Tomé and Príncipe</span>
                </div>
            </div>

        </div>

    </div>

</div>

<!-- Copyright Section -->
<div class="elementor-element elementor-element-3cc2c7f1 e-flex e-con-boxed e-con e-parent" data-element_type="container" data-id="3cc2c7f1" data-settings='{{"background_background":"gradient"}}' style="border-top: 1px solid rgba(12, 74, 110, 0.1); margin-top: 0;">
    <div class="e-con-inner">
        <div class="elementor-element elementor-element-70813cef elementor-widget elementor-widget-heading" data-element_type="widget" data-id="70813cef" data-widget_type="heading.default">
            <p class="elementor-heading-title elementor-size-default" style="font-size: 15px; color: {THEME_COLOR}; opacity: 0.7; text-align: center; padding: 40px 0;">© All rights reserved Center Marine Certificate Service​</p>
        </div>
    </div>
</div>
</footer>'''

def restore_footer(filepath):
    try:
        with open(filepath, 'r', encoding='utf-8') as f:
            content = f.read()
    except:
        return False
    
    original = content
    logo_src = get_logo_path_for_file(filepath)
    new_footer_block = generate_full_footer_html(logo_src)
    
    pattern = r'<footer[^>]*>.*?</footer>'
    
    content = re.sub(pattern, new_footer_block, content, flags=re.DOTALL)
    
    if content != original:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        return True
    return False

def main():
    print("=" * 60)
    print("RESTORE FOOTER V8 (No-Wrap) - FORCE OVERWRITE")
    print("=" * 60)
    
    fixed = 0
    for root, dirs, files in os.walk(TARGET_DIR):
        dirs[:] = [d for d in dirs if d not in ['.git', 'node_modules', 'wp-json']]
        for file in files:
            if file.endswith('.html'):
                if restore_footer(os.path.join(root, file)):
                    fixed += 1
                    print(f"  Restored: {file}")
    
    print(f"\nUpdated {fixed} files")

if __name__ == "__main__":
    main()
