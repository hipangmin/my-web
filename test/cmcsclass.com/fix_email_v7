#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Fix Email V7 - Tight & Aligned
1. Two emails vertically aligned (left edge)
2. Tight spacing between them
"""

import os
import re

TARGET_DIR = r"d:\ypm\my web\test\cmcsclass.com"

# Old email pattern (various formats from previous fixes)
OLD_EMAIL_PATTERNS = [
    r'<span class="elementor-icon-list-text">Email: <a href="mailto:technical@cmcsclass\.org"[^>]*>technical@cmcsclass\.org</a><br><span style="margin-left: [^"]*"><a href="mailto:fleet@cmcsclass\.org"[^>]*>fleet@cmcsclass\.org</a></span></span>',
    r'<span class="elementor-icon-list-text">Email:\s*<a href="mailto:technical@cmcsclass\.org"[^>]*>technical@cmcsclass\.org</a><br>\s*<span style="margin-left: [^"]*;?"><a href="mailto:fleet@cmcsclass\.org"[^>]*>fleet@cmcsclass\.org</a></span></span>',
]

# New aligned email HTML - using display:block for perfect alignment
NEW_EMAIL_HTML = '''<span class="elementor-icon-list-text">Email: <a href="mailto:technical@cmcsclass.org" style="color: inherit; text-decoration: none;">technical@cmcsclass.org</a><br><span style="margin-left: 2.75em;"><a href="mailto:fleet@cmcsclass.org" style="color: inherit; text-decoration: none;">fleet@cmcsclass.org</a></span></span>'''

# Tighter CSS
TIGHT_CSS = '''<style id="contact-us-spacing-final">
/* Contact Us Spacing V7 - Tight & Aligned */

/* Location paragraph */
.elementor-element-1a327498 p,
.elementor-widget-text-editor p {
    margin-bottom: 8px !important;
    line-height: 1.4 !important;
}

/* List items spacing */
.elementor-widget-icon-list .elementor-icon-list-items li.elementor-icon-list-item {
    margin-bottom: 8px !important;
    padding-bottom: 0 !important;
}
.elementor-widget-icon-list .elementor-icon-list-items li.elementor-icon-list-item:last-child {
    margin-bottom: 0 !important;
}

/* VERY TIGHT email line height */
.elementor-widget-icon-list .elementor-icon-list-text {
    line-height: 1.2 !important;
}

/* Text editor container */
.elementor-element-1a327498 .elementor-widget-container {
    margin-bottom: 0 !important;
}
</style>'''

def fix_file(filepath):
    try:
        with open(filepath, 'r', encoding='utf-8') as f:
            content = f.read()
    except:
        return False
    
    original = content
    
    # Fix email HTML for better alignment
    for pattern in OLD_EMAIL_PATTERNS:
        content = re.sub(pattern, NEW_EMAIL_HTML, content, flags=re.DOTALL)
    
    # Update CSS
    old_css_pattern = r'<style id="contact-us-spacing-final">.*?</style>'
    if re.search(old_css_pattern, content, re.DOTALL):
        content = re.sub(old_css_pattern, TIGHT_CSS, content, flags=re.DOTALL)
    
    if content != original:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        return True
    return False

def main():
    print("=" * 60)
    print("EMAIL FIX V7 - Tight & Aligned")
    print("=" * 60)
    
    fixed = 0
    for root, dirs, files in os.walk(TARGET_DIR):
        dirs[:] = [d for d in dirs if d not in ['.git', 'node_modules', 'wp-json']]
        for file in files:
            if file.endswith('.html'):
                if fix_file(os.path.join(root, file)):
                    fixed += 1
                    print(f"  Fixed: {file}")
    
    print(f"\nUpdated {fixed} files")

if __name__ == "__main__":
    main()
